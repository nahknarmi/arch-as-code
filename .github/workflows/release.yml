name: arch-as-code CI

on: [push]

  branches:
    - installation-tests
  tags:
    - v*

jobs:

  release:
    needs: build
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [windows-latest, ubuntu-latest, macOS-latest]
    steps:
      - uses: actions/checkout@v1
      - name: Set up JDK 1.8
        uses: actions/setup-java@v1
        with:
          java-version: 1.8

      - name: Test Installation on macOS & Ubuntu
        if: matrix.os == 'ubuntu-latest' || matrix.os == 'macOS-latest'
        run: ./scripts/install/${{ matrix.os }}/install.sh
        env:
          STRUCTURIZR_API_KEY: ${{ secrets.TEST_STRUCTURIZR_API_KEY }}
          STRUCTURIZR_API_SECRET: ${{ secrets.TEST_STRUCTURIZR_API_SECRET }}
          STRUCTURIZR_WORKSPACE_ID: ${{ secrets.TEST_STRUCTURIZR_WORKSPACE_ID }}

      - name: Test Installation on Windows
        if: matrix.os == 'windows-latest'
        run: .\scripts\install\${{ matrix.os }}\install.ps1
        shell: pwsh
        env:
          STRUCTURIZR_API_KEY: ${{ secrets.TEST_STRUCTURIZR_API_KEY }}
          STRUCTURIZR_API_SECRET: ${{ secrets.TEST_STRUCTURIZR_API_SECRET }}
          STRUCTURIZR_WORKSPACE_ID: ${{ secrets.TEST_STRUCTURIZR_WORKSPACE_ID }}